<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İşletme Profili</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* Resource Styles */
        .resources-container {
            margin-top: 20px;
        }
        
        .resource-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .add-resource-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .add-resource-btn:hover {
            background: #2980b9;
        }
        
        .resources-list {
            margin-top: 15px;
        }
        
        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .resource-details {
            flex-grow: 1;
        }
        
        .resource-name {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .resource-type {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .resource-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active {
            background: #e1f5fe;
            color: #0288d1;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #e53935;
        }
        
        .resource-actions {
            display: flex;
            gap: 10px;
        }
        
        .resource-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .resource-actions button:hover {
            background: #f5f5f5;
        }
        
        #businessTypeMessage {
            padding: 10px 15px;
            background: #e1f5fe;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
            color: #0277bd;
        }
        
        /* Takvim Stilleri */
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-date {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .nav-button {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            background: #e9ecef;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .day-column {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        .day-header {
            background: #3498db;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }

        .appointment-slots {
            padding: 10px;
        }

        .appointment-slot {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .slot-time {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .slot-status {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #7f8c8d;
        }

        .slot-status .material-icons {
            font-size: 16px;
            margin-right: 5px;
        }

        .slot-status.available {
            color: #27ae60;
        }

        .slot-status.booked {
            color: #e74c3c;
        }

        .slot-status.past {
            color: #95a5a6;
        }

        .appointment-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .customer-info {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }

        .customer-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f39c12;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .customer-name {
            font-weight: 500;
        }

        .service-tag {
            display: inline-block;
            background: #f1c40f;
            color: #34495e;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            margin-top: 5px;
        }

        .save-btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .add-time-slot {
            background: #2ecc71;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .add-time-slot:hover {
            background: #27ae60;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
            border: 4px solid #3498db;
        }

        .profile-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .info-group h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .info-group p {
            color: #34495e;
            margin: 5px 0;
        }

        .edit-btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .business-type {
            display: inline-block;
            padding: 6px 12px;
            background: #e8f4fc;
            color: #3498db;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }

        .address-info {
            grid-column: 1 / -1;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #3498db;
            font-size: 24px;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .appointment-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .time-slot {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .time-slot select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .time-slot button {
            padding: 8px 12px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-time-slot {
            margin-top: 10px;
            padding: 8px 12px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .week-schedule {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .schedule-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .time-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }

        /* Switch stil */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;

            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(16px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 17px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
        

        
        .save-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .save-btn:hover {
            background-color: #45a049;
        }
</style>
</head>
<body>
    <div class="profile-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('profile')">Profil Bilgileri</button>
            <button class="tab" onclick="switchTab('appointments')">Randevu Ayarları</button>
            <button class="tab" onclick="switchTab('resources')">Kaynaklar</button>
        </div>

        <div id="profileTab" class="tab-content active">
            <div class="profile-header">
                <img id="profileImage" class="profile-image" src="" alt="Profil Fotoğrafı">
                <h1 id="businessName">İşletme Adı</h1>
                <span id="businessType" class="business-type">İşletme Türü</span>
            </div>

            <div class="profile-info">
                <div class="info-group">
                    <h3>İletişim Bilgileri</h3>
                    <p><strong>Telefon:</strong> <span id="businessPhone"></span></p>
                </div>

                <div class="info-group">
                    <h3>Konum Bilgileri</h3>
                    <p><strong>Şehir:</strong> <span id="city"></span></p>
                    <p><strong>İlçe:</strong> <span id="district"></span></p>
                </div>

                <div class="info-group address-info">
                    <h3>Adres</h3>
                    <p id="address"></p>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>Aktif Randevular</h3>
                    <p id="activeAppointments">0</p>
                </div>
                <div class="stat-card">
                    <h3>Toplam Randevular</h3>
                    <p id="totalAppointments">0</p>
                </div>
                <div class="stat-card">
                    <h3>Rezervasyon Ücreti</h3>
                    <p id="reservationPrice">0 TL</p>
                </div>
            </div>

            <button class="edit-btn" onclick="window.location.href='/business-profile.html'">
                <span class="material-icons">edit</span>
                Profili Düzenle
            </button>
        </div>


        
        <div id="appointmentsTab" class="tab-content">
            <div class="appointment-settings">
                <h3>Randevu Ayarları</h3>
                <p>Bu kısımda randevu ayarlarınızı yönetebilirsiniz.</p>
                <p>Yakında kullanıma açılacaktır.</p>
            </div>
        </div>

        <div id="resourcesTab" class="tab-content">
            <div class="resources-container">
                <h3>Kaynaklar</h3>
                <p>Bu kısımda işletmenize ait kaynakları ekleyebilir ve yönetebilirsiniz.</p>
                
                <div id="businessTypeMessage"></div>
                
                <div class="resource-form">
                    <h4>Yeni Kaynak Ekle</h4>
                    <div class="form-group">
                        <label for="resourceName">Kaynak İsmi</label>
                        <input type="text" id="resourceName" placeholder="Kaynağın adını girin" required>
                    </div>
                    <div class="form-actions">
                        <button id="addResourceBtn" class="btn add-resource-btn">Kaynak Ekle</button>
                    </div>
                </div>

                <div class="resources-list-container">
                    <h4>Mevcut Kaynaklar</h4>
                    <div id="resourcesList" class="resources-list">
                        <p id="noResourcesMsg">Henüz kaynak eklenmemiş.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let businessType = ''; // Global değişken olarak işletme türünü saklayacağız
        const resourceTypeMap = {
            'dishekimi': 'klinik',
            'kuafor': 'koltuk',
            'guzelliksalonu': 'koltuk',
            'spa': 'oda',
            'halısaha': 'saha',
            'restoran': 'masa',
            'cafe': 'masa'
        };
        
        // İşletme türüne göre uygun kaynak tipi etiketini döndürür
        function getResourceTypeLabel() {
            const typeLabels = {
                'dishekimi': 'Klinik',
                'kuafor': 'Koltuk',
                'guzelliksalonu': 'Koltuk',
                'spa': 'Oda',
                'halısaha': 'Saha',
                'restoran': 'Masa',
                'cafe': 'Masa'
            };
            
            return typeLabels[businessType] || 'Kaynak';
        }
        
        // İşletme türüne göre uygun açıklama metnini döndürür
        function getBusinessTypeMessage() {
            const messages = {
                'dishekimi': 'Diş hekimleri için klinik ekleyebilirsiniz.',
                'kuafor': 'Kuaförler için koltuk ekleyebilirsiniz.',
                'guzelliksalonu': 'Güzellik salonları için koltuk ekleyebilirsiniz.',
                'spa': 'Spa salonları için oda ekleyebilirsiniz.',
                'halısaha': 'Halı sahalar için saha ekleyebilirsiniz.',
                'restoran': 'Restoranlar için masa ekleyebilirsiniz.',
                'cafe': 'Cafeler için masa ekleyebilirsiniz.'
            };
            
            return messages[businessType] || 'İşletmeniz için kaynak ekleyebilirsiniz.';
        }
        
        // Kaynakları yükle
        async function loadResources() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/business/resources', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Kaynaklar yüklenemedi');
                }
                
                const data = await response.json();
                businessType = data.businessType.toLowerCase().replace(/\s+/g, '');
                
                // İşletme türüne göre mesaj ve placeholder güncelleme
                document.getElementById('businessTypeMessage').textContent = getBusinessTypeMessage();
                document.getElementById('resourceName').placeholder = `${getResourceTypeLabel()} adını girin (Örn: ${getResourceTypeLabel()} 1)`;
                
                const resourcesList = document.getElementById('resourcesList');
                const noResourcesMsg = document.getElementById('noResourcesMsg');
                
                if (data.resources.length === 0) {
                    noResourcesMsg.style.display = 'block';
                    return;
                }
                
                noResourcesMsg.style.display = 'none';
                resourcesList.innerHTML = '';
                
                // Kaynakları listele
                data.resources.forEach(resource => {
                    const resourceItem = document.createElement('div');
                    resourceItem.className = 'resource-item';
                    resourceItem.innerHTML = `
                        <div class="resource-details">
                            <div class="resource-name">${resource.name}</div>
                            <div class="resource-type">${getResourceTypeLabel()}</div>
                        </div>
                        <div class="resource-status ${resource.status === 'active' ? 'status-active' : 'status-inactive'}">
                            ${resource.status === 'active' ? 'Aktif' : 'Pasif'}
                        </div>
                        <div class="resource-actions">
                            <button onclick="deleteResource(${resource.id})" title="Sil">
                                <span class="material-icons">delete</span>
                            </button>
                        </div>
                    `;
                    resourcesList.appendChild(resourceItem);
                });
            } catch (error) {
                console.error('Kaynaklar yüklenirken hata:', error);
            }
        }
        
        // Yeni kaynak ekle
        async function addResource() {
            const resourceName = document.getElementById('resourceName').value.trim();
            
            if (!resourceName) {
                alert('Lütfen kaynak adını girin');
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/business/resources', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name: resourceName,
                        resourceType: resourceTypeMap[businessType] || 'generic'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Kaynak eklenemedi');
                }
                
                document.getElementById('resourceName').value = '';
                loadResources(); // Kaynakları yeniden yükle
            } catch (error) {
                console.error('Kaynak eklenirken hata:', error);
                alert('Kaynak eklenirken bir hata oluştu');
            }
        }
        
        // Kaynak sil
        async function deleteResource(id) {
            if (!confirm('Bu kaynağı silmek istediğinizden emin misiniz?')) {
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`/api/business/resources/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Kaynak silinemedi');
                }
                
                loadResources(); // Kaynakları yeniden yükle
            } catch (error) {
                console.error('Kaynak silinirken hata:', error);
                alert('Kaynak silinirken bir hata oluştu');
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addResourceBtn').addEventListener('click', addResource);
        });
        
        async function loadBusinessProfile() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Oturum bulunamadı');
                }

                // İşletme profil bilgilerini getir
                const profileResponse = await fetch('/api/business-profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!profileResponse.ok) {
                    throw new Error('Profil bilgileri alınamadı');
                }

                const profileData = await profileResponse.json();

                // Profil bilgilerini doldur
                document.getElementById('businessName').textContent = profileData.business_name;
                document.getElementById('businessType').textContent = profileData.business_type;
                document.getElementById('businessPhone').textContent = profileData.business_phone;
                document.getElementById('city').textContent = profileData.city;
                document.getElementById('district').textContent = profileData.district;
                document.getElementById('address').textContent = profileData.address;
                document.getElementById('reservationPrice').textContent = `${profileData.reservation_price} TL`;

                if (profileData.image_url) {
                    document.getElementById('profileImage').src = profileData.image_url;
                }

                // Randevu istatistiklerini getir
                const statsResponse = await fetch('/api/business/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    document.getElementById('activeAppointments').textContent = statsData.active_appointments;
                    document.getElementById('totalAppointments').textContent = statsData.total_appointments;
                }

                // Randevu saatlerini yükle
                await loadTimeSlots();

            } catch (error) {
                console.error('Profil yükleme hatası:', error);
                alert(error.message);
            }
        }

        async function loadTimeSlots() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/business/appointment-times', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const timeSlots = await response.json();
                    const timeSlotsContainer = document.getElementById('timeSlots');
                    timeSlotsContainer.innerHTML = '';

                    timeSlots.forEach(slot => {
                        addTimeSlot(slot.start_time, slot.end_time);
                    });
                }
            } catch (error) {
                console.error('Randevu saatleri yükleme hatası:', error);
            }
        }

        async function saveTimeSlots() {
            try {
                const token = localStorage.getItem('token');
                const timeSlots = [];
                const timeSlotElements = document.querySelectorAll('.time-slot');

                timeSlotElements.forEach(element => {
                    const startTime = element.querySelector('select:first-child').value;
                    const endTime = element.querySelector('select:last-child').value;
                    timeSlots.push({ startTime, endTime });
                });

                const response = await fetch('/api/business/appointment-times', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ timeSlots })
                });

                if (response.ok) {
                    alert('Randevu saatleri başarıyla kaydedildi');
                } else {
                    throw new Error('Randevu saatleri kaydedilemedi');
                }
            } catch (error) {
                console.error('Randevu saatleri kaydetme hatası:', error);
                alert(error.message);
            }
        }

        function addTimeSlot(startTime = '09:00', endTime = '17:00') {
            const timeSlotsContainer = document.getElementById('timeSlots');
            const timeSlotDiv = document.createElement('div');
            timeSlotDiv.className = 'time-slot';
            
            const startTimeSelect = document.createElement('select');
            startTimeSelect.innerHTML = generateTimeOptions();
            startTimeSelect.value = startTime;
            
            const endTimeSelect = document.createElement('select');
            endTimeSelect.innerHTML = generateTimeOptions();
            endTimeSelect.value = endTime;
            
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<span class="material-icons">delete</span>';
            deleteButton.onclick = function() {
                timeSlotDiv.remove();
            };
            
            timeSlotDiv.appendChild(startTimeSelect);
            timeSlotDiv.appendChild(endTimeSelect);
            timeSlotDiv.appendChild(deleteButton);
            
            timeSlotsContainer.appendChild(timeSlotDiv);
        }

        function generateTimeOptions() {
            let options = '';
            for (let hour = 9; hour <= 18; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    options += `<option value="${time}">${time}</option>`;
                }
            }
            return options;
        }

        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabName)) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            tabContents.forEach(content => {
                if (content.id === tabName + 'Tab') {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // Kaynaklar sekmesi seçildiğinde kaynakları yükle
            if (tabName === 'resources') {
                loadResources();
            }
        }

        // Takvim fonksiyonları
        let currentWeekStart = new Date();
        let businessSchedule = [];
        let appointmentsData = [];

        function initializeCalendar() {
            // İlk hafta başlangıcını al (Pazartesi)
            currentWeekStart = getWeekStart(new Date());
            
            // Butonlara olay dinleyicileri ekle
            document.getElementById('prevWeekBtn').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                renderCalendar();
            });
            
            document.getElementById('nextWeekBtn').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                renderCalendar();
            });
            
            // Kaydet butonuna olay dinleyicisi ekle
            document.getElementById('saveCalendarBtn').addEventListener('click', saveAppointmentChanges);
            
            // İşletme çalışma saatlerini al
            loadBusinessSchedule();
        }
        
        async function loadBusinessSchedule() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Oturum bulunamadı');
                }
                
                // Çalışma saatlerini al
                const response = await fetch('/api/business/schedule', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Çalışma saatleri alınamadı');
                }
                
                const data = await response.json();
                
                // Varsayılan çalışma saatlerini ayarla
                const defaultSchedule = [
                    { day_of_week: 0, is_working: true, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 1, is_working: true, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 2, is_working: true, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 3, is_working: true, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 4, is_working: true, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 5, is_working: false, start_time: '09:00', end_time: '18:00' },
                    { day_of_week: 6, is_working: false, start_time: '09:00', end_time: '18:00' }
                ];
                
                // Eğer veri yoksa varsayılan değerleri kullan
                const schedule = data && data.length ? data : defaultSchedule;
                
                // Her gün için çalışma durumunu ve saatlerini ayarla
                schedule.forEach(daySchedule => {
                    const dayIndex = daySchedule.day_of_week;
                    
                    // Çalışma durumu checkbox'unu ayarla
                    const workingCheckbox = document.querySelector(`input[name="isWorking-${dayIndex}"]`);
                    if (workingCheckbox) {
                        workingCheckbox.checked = daySchedule.is_working;
                        
                        // Başlangıç ve bitiş saati seçimlerini ayarla
                        const startTimeSelect = document.querySelector(`select[name="startTime-${dayIndex}"]`);
                        const endTimeSelect = document.querySelector(`select[name="endTime-${dayIndex}"]`);
                        
                        if (startTimeSelect && endTimeSelect) {
                            startTimeSelect.value = daySchedule.start_time;
                            endTimeSelect.value = daySchedule.end_time;
                            
                            // Çalışma durumuna göre inputları aktif/pasif yap
                            startTimeSelect.disabled = !daySchedule.is_working;
                            endTimeSelect.disabled = !daySchedule.is_working;
                        }
                    }
                });
                
                // Switch event listener'larını ekle
                document.querySelectorAll('input[name^="isWorking-"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const dayIndex = this.name.split('-')[1];
                        const startTimeSelect = document.querySelector(`select[name="startTime-${dayIndex}"]`);
                        const endTimeSelect = document.querySelector(`select[name="endTime-${dayIndex}"]`);
                        
                        if (startTimeSelect && endTimeSelect) {
                            startTimeSelect.disabled = !this.checked;
                            endTimeSelect.disabled = !this.checked;
                        }
                    });
                });
                
            } catch (error) {
                console.error('Hata:', error);
                alert(`Hata: ${error.message}`);
            }
        }
        
        async function saveBusinessSchedule() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Oturum bulunamadı');
                }
                
                // Çalışma saatlerini topla
                const schedule = [];
                
                for (let i = 0; i < 7; i++) { // Tüm günler için (0: Pazartesi, 1: Salı, ... 6: Pazar)
                    const isWorkingElem = document.querySelector(`input[name="isWorking-${i}"]`);
                    const startTimeElem = document.querySelector(`select[name="startTime-${i}"]`);
                    const endTimeElem = document.querySelector(`select[name="endTime-${i}"]`);
                    
                    if (isWorkingElem && startTimeElem && endTimeElem) {
                        schedule.push({
                            day: getDayName(i),
                            isWorking: isWorkingElem.checked,
                            startTime: startTimeElem.value,
                            endTime: endTimeElem.value
                        });
                    }
                }
                
                // Çalışma saatlerini güncelle
                const response = await fetch('/api/business/schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ schedule })
                });
                
                if (!response.ok) {
                    throw new Error('Çalışma saatleri güncellenemedi');
                }
                
                const result = await response.json();
                alert('Çalışma saatleri başarıyla güncellendi');
            } catch (error) {
                console.error('Hata:', error);
                alert(`Hata: ${error.message}`);
            }
        }
        
        // Haftanın başlangıç gününü bulan fonksiyon (Pazartesi)
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Pazar günüyse önceki haftanın pazartesine git
            return new Date(d.setDate(diff));
        }
        
        // Takvimi render eden fonksiyon
        function renderCalendar() {
            const calendarGrid = document.getElementById('appointmentCalendar');
            const currentWeekDisplay = document.getElementById('currentWeekDisplay');
            
            // Tarih formatını ayarla
            const options = { day: 'numeric', month: 'long', year: 'numeric', weekday: 'long' };
            currentWeekDisplay.textContent = currentWeekStart.toLocaleDateString('tr-TR', options);
            
            // Takvimi temizle
            calendarGrid.innerHTML = '';
            
            // Hafta içi günleri oluştur (Pazartesi-Cuma)
            for (let i = 0; i < 5; i++) {
                const dayDate = new Date(currentWeekStart);
                dayDate.setDate(currentWeekStart.getDate() + i);
                
                const dayOfWeek = dayDate.getDay() || 7; // 0 = Pazar, 1-6 = Pazartesi-Cumartesi
                const daySchedule = businessSchedule.find(s => s.day_of_week === dayOfWeek);
                
                const dayColumn = createDayColumn(dayDate, daySchedule);
                calendarGrid.appendChild(dayColumn);
            }
        }
        
        // Gün kolonunu oluşturan fonksiyon
        function createDayColumn(date, daySchedule) {
            const dayColumn = document.createElement('div');
            dayColumn.className = 'day-column';
            
            // Gün başlığı
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-header';
            
            const dayOptions = { weekday: 'long' };
            const dateOptions = { day: 'numeric', month: 'numeric' };
            
            dayHeader.textContent = `${date.toLocaleDateString('tr-TR', dayOptions)}\n${date.toLocaleDateString('tr-TR', dateOptions)}`;
            dayColumn.appendChild(dayHeader);
            
            // Randevu slotları
            const appointmentSlots = document.createElement('div');
            appointmentSlots.className = 'appointment-slots';
            
            // Eğer çalışma günü ise randevu slotlarını ekle
            if (daySchedule && daySchedule.is_working) {
                const startHour = parseInt(daySchedule.start_time.split(':')[0]);
                const endHour = parseInt(daySchedule.end_time.split(':')[0]);
                
                // Her saat için randevu slotu oluştur
                for (let hour = startHour; hour < endHour; hour++) {
                    const slotTime = new Date(date);
                    slotTime.setHours(hour, 0, 0, 0);
                    
                    // Geçmiş zaman kontrolü
                    const now = new Date();
                    const isPast = slotTime < now;
                    
                    // Randevusu var mı kontrolü
                    const appointment = appointmentsData.find(a => {
                        const appDate = new Date(a.appointment_date);
                        return appDate.getDate() === slotTime.getDate() && 
                               appDate.getMonth() === slotTime.getMonth() && 
                               appDate.getFullYear() === slotTime.getFullYear() && 
                               appDate.getHours() === slotTime.getHours();
                    });
                    
                    const slot = createAppointmentSlot(slotTime, isPast, appointment);
                    appointmentSlots.appendChild(slot);
                }
            } else {
                // Çalışma günü değilse bilgi mesajı göster
                const noWorkingDay = document.createElement('div');
                noWorkingDay.className = 'appointment-slot';
                noWorkingDay.innerHTML = '<div class="slot-status">Bu gün çalışma saatiniz bulunmamaktadır.</div>';
                appointmentSlots.appendChild(noWorkingDay);
            }
            
            dayColumn.appendChild(appointmentSlots);
            return dayColumn;
        }
        
        // Randevu slotu oluşturan fonksiyon
        function createAppointmentSlot(time, isPast, appointment) {
            const slot = document.createElement('div');
            slot.className = 'appointment-slot';
            
            // Saat bilgisi
            const slotTime = document.createElement('div');
            slotTime.className = 'slot-time';
            slotTime.textContent = time.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            slot.appendChild(slotTime);
            
            // Durum bilgisi
            const slotStatus = document.createElement('div');
            
            if (isPast) {
                // Geçmiş zaman
                slotStatus.className = 'slot-status past';
                slotStatus.innerHTML = '<span class="material-icons">lock</span> Geçmiş zaman';
            } else if (appointment) {
                // Randevu dolu
                slotStatus.className = 'slot-status booked';
                slotStatus.innerHTML = '<span class="material-icons">event_busy</span> Randevu Talepleri (1/5)';
                
                // Randevu detayları
                const appointmentDetails = document.createElement('div');
                appointmentDetails.className = 'appointment-details';
                
                // Müşteri bilgisi
                const customerInfo = document.createElement('div');
                customerInfo.className = 'customer-info';
                
                const customerAvatar = document.createElement('div');
                customerAvatar.className = 'customer-avatar';
                customerAvatar.textContent = appointment.customer_name ? appointment.customer_name.charAt(0).toUpperCase() : 'A';
                
                const customerName = document.createElement('div');
                customerName.className = 'customer-name';
                customerName.textContent = appointment.customer_name || 'Ali Biçer';
                
                customerInfo.appendChild(customerAvatar);
                customerInfo.appendChild(customerName);
                
                // Hizmet etiketi
                const serviceTag = document.createElement('div');
                serviceTag.className = 'service-tag';
                serviceTag.textContent = appointment.service_name || 'Bekliyor';
                
                appointmentDetails.appendChild(customerInfo);
                appointmentDetails.appendChild(serviceTag);
                
                slot.appendChild(appointmentDetails);
            } else {
                // Randevu boş
                slotStatus.className = 'slot-status available';
                slotStatus.innerHTML = '<span class="material-icons">event_available</span> Giriş yapınız';
            }
            
            slot.appendChild(slotStatus);
            return slot;
        }
        
        // Randevu değişikliklerini kaydetme fonksiyonu
        async function saveAppointmentChanges() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    throw new Error('Oturum bulunamadı');
                }

                // Çalışma saatlerini topla
                const schedule = [];
                
                for (let i = 0; i < 5; i++) { // Pazartesi-Cuma için
                    const isWorking = document.querySelector(`input[name="isWorking-${i}"]`).checked;
                    const startTime = document.querySelector(`select[name="startTime-${i}"]`).value;
                    const endTime = document.querySelector(`select[name="endTime-${i}"]`).value;
                    
                    schedule.push({
                        day_of_week: i + 1, // 1: Pazartesi, 2: Salı, ...
                        is_working: isWorking,
                        start_time: startTime,
                        end_time: endTime
                    });
                }
                
                // Randevu süresini al
                const appointmentDuration = document.getElementById('appointmentDuration').value;
                
                // Çalışma saatlerini güncelle
                const response = await fetch('/api/business/schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        schedule: schedule,
                        appointmentDuration: appointmentDuration
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Ayarlar kaydedilemedi');
                }
                
                alert('Randevu ayarları başarıyla kaydedildi');
                
                // Takvimi güncelle
                businessSchedule = schedule;
                renderCalendar();
                
            } catch (error) {
                console.error('Kaydetme hatası:', error);
                alert(`Hata: ${error.message}`);
            }
        }

// Randevu slotu oluşturan fonksiyon
function createAppointmentSlot(time, isPast, appointment) {
    const slot = document.createElement('div');
    slot.className = 'appointment-slot';
    
    // Saat bilgisi
    const slotTime = document.createElement('div');
    slotTime.className = 'slot-time';
    slotTime.textContent = time.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
    slot.appendChild(slotTime);
    
    // Durum bilgisi
    const slotStatus = document.createElement('div');
    
    if (isPast) {
        // Geçmiş zaman
        slotStatus.className = 'slot-status past';
        slotStatus.innerHTML = '<span class="material-icons">lock</span> Geçmiş zaman';
    } else if (appointment) {
        // Randevu dolu
        slotStatus.className = 'slot-status booked';
        slotStatus.innerHTML = '<span class="material-icons">event_busy</span> Randevu Talepleri (1/5)';
        
        // Randevu detayları
        const appointmentDetails = document.createElement('div');
        appointmentDetails.className = 'appointment-details';
        
        // Müşteri bilgisi
        const customerInfo = document.createElement('div');
        customerInfo.className = 'customer-info';
        
        const customerAvatar = document.createElement('div');
        customerAvatar.className = 'customer-avatar';
        customerAvatar.textContent = appointment.customer_name ? appointment.customer_name.charAt(0).toUpperCase() : 'A';
        
        const customerName = document.createElement('div');
        customerName.className = 'customer-name';
        customerName.textContent = appointment.customer_name || 'Ali Biçer';
        
        customerInfo.appendChild(customerAvatar);
        customerInfo.appendChild(customerName);
        
        // Hizmet etiketi
        const serviceTag = document.createElement('div');
        serviceTag.className = 'service-tag';
        serviceTag.textContent = appointment.service_name || 'Bekliyor';
        
        appointmentDetails.appendChild(customerInfo);
        appointmentDetails.appendChild(serviceTag);
        
        slot.appendChild(appointmentDetails);
    } else {
        // Randevu boş
        slotStatus.className = 'slot-status available';
        slotStatus.innerHTML = '<span class="material-icons">event_available</span> Giriş yapınız';
    }
    
    slot.appendChild(slotStatus);
    return slot;
}

// Randevu değişikliklerini kaydetme fonksiyonu
async function saveAppointmentChanges() {
    try {
        const token = localStorage.getItem('token');
        if (!token) {
            throw new Error('Oturum bulunamadı');
        }

        // Çalışma saatlerini topla
        const schedule = [];
        
        for (let i = 0; i < 5; i++) { // Pazartesi-Cuma için
            const isWorking = document.querySelector(`input[name="isWorking-${i}"]`).checked;
            const startTime = document.querySelector(`select[name="startTime-${i}"]`).value;
            const endTime = document.querySelector(`select[name="endTime-${i}"]`).value;
            
            schedule.push({
                day_of_week: i + 1, // 1: Pazartesi, 2: Salı, ...
                is_working: isWorking,
                start_time: startTime,
                end_time: endTime
            });
        }
        
        // Randevu süresini al
        const appointmentDuration = document.getElementById('appointmentDuration').value;
        
        // Çalışma saatlerini güncelle
        const response = await fetch('/api/business/schedule', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                schedule: schedule,
                appointmentDuration: appointmentDuration
            })
        });
        
        if (!response.ok) {
            throw new Error('Ayarlar kaydedilemedi');
        }
        
        alert('Randevu ayarları başarıyla kaydedildi');
        
        // Takvimi güncelle
        businessSchedule = schedule;
        renderCalendar();
        
    } catch (error) {
        console.error('Kaydetme hatası:', error);
        alert(`Hata: ${error.message}`);
    }
}

// Sayfa yüklendiginde profil ve kaynakları yükle
document.addEventListener('DOMContentLoaded', function() {
    loadBusinessProfile();
    
    // Doğru sekmeyi göster (URL'den alınabilir)
    const hash = window.location.hash.substring(1) || 'profile';
    switchTab(hash);
    
    // Hash değişikliklerini dinle
    window.addEventListener('hashchange', function() {
        const newHash = window.location.hash.substring(1) || 'profile';
        switchTab(newHash);
    });
    
    // Çalışma saatleri kaydetme butonuna event listener ekle
    const saveScheduleBtn = document.getElementById('saveScheduleBtn');
    if (saveScheduleBtn) {
        saveScheduleBtn.addEventListener('click', saveBusinessSchedule);
    }
});
</script>
</body>
</html>